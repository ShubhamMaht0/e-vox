<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Eco Tasks App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(135deg, #e0f7fa, #a7ffeb);
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 20px;
      background: #3bba3b;
      color: white;
    }
    .container {
      max-width: 1000px;
      margin: auto;
      padding: 20px;
    }
    h2 {
      color: #004d40;
    }
    .task {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    input[type=file] {
      margin-top: 5px;
    }
    button {
      background: #276f27;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #004d40;
    }
    .dashboard, .leaderboard {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    .progress-circle {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: conic-gradient(#00796b var(--progress,0%), #ccc 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #004d40;
      font-size: 20px;
      font-weight: bold;
      margin: auto;
    }
    .progress-bar {
      background: #ccc;
      border-radius: 10px;
      height: 20px;
      width: 100%;
      margin-top: 15px;
    }
    .progress-bar-inner {
      background: #00796b;
      height: 100%;
      width: 0%;
      border-radius: 10px;
      transition: width 0.5s ease;
    }
    .badges span {
      font-size: 24px;
      margin: 0 5px;
    }
    .leaderboard .entry {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
    .confetti {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none;
      overflow: hidden;
    }
    .confetti span {
      position: absolute;
      font-size: 20px;
      animation: fall 3s linear forwards;
    }
    @keyframes fall {
      to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <header>
    <h1>🌍 Eco Education Task</h1>
  </header>
  <div class="container">
    <section class="tasks">
      <h2>Tasks</h2>
      <div id="taskList"></div>
    </section>
    <section class="dashboard">
      <h2>📊 Progress Dashboard</h2>
      <div class="progress-circle" id="progressCircle">0%</div>
      <div class="progress-bar"><div id="progressBar" class="progress-bar-inner"></div></div>
      <p>Tasks Completed: <span id="completedCount">0</span></p>
      <p>Total Points: <span id="points">0</span></p>
      <div class="badges">Badges: <span id="badges"></span></div>
      <button onclick="resetProgress()">🔄 Reset Progress</button>
    </section>
    <section class="leaderboard">
      <h2>🏆 Leaderboard</h2>
      <div id="leaderboard"></div>
    </section>
  </div>
  <div class="confetti" id="confetti"></div>

<script>
const tasks = [
  "Plant a sapling in your garden or locality",
  "Collect and segregate recyclable waste",
  "Switch off lights and fans when not in use",
  "Use a reusable bottle instead of plastic",
  "Organize a campus cleanup drive",
  "Create an awareness poster on climate change"
];

// load saved data
let completed = JSON.parse(localStorage.getItem('completed')) || [];
let points = parseInt(localStorage.getItem('points')) || 0;
let username = localStorage.getItem("username");
if(!username){
  username = prompt("Enter your name:");
  localStorage.setItem("username", username);
}
let leaderboard = [
  {name:"Alice 🌱", points:80},
  {name:"Ravi 🌳", points:60},
  {name:"Maya 🌍", points:40},
  {name:username+" 🍃", points:points}
];

function renderTasks(){
  const list=document.getElementById('taskList');
  list.innerHTML="";
  tasks.forEach((t,i)=>{
    const div=document.createElement('div');
    div.className="task";
    const isDone = completed.includes(i);
    div.innerHTML=`
      <span><b>${t}</b></span>
      ${isDone ? "<strong>✅ Completed</strong>" : `
        <label>📂 Upload from Gallery: 
          <input type="file" id="gallery${i}" accept="image/*">
        </label>
        <label>📸 Take Photo: 
          <input type="file" id="camera${i}" accept="image/*" capture="environment">
        </label>
        <button onclick="submitTask(${i})">Submit</button>
      `}
    `;
    list.appendChild(div);
  });
}

function submitTask(i){
  const galleryInput = document.getElementById(`gallery${i}`);
  const cameraInput = document.getElementById(`camera${i}`);
  
  if((!galleryInput || galleryInput.files.length === 0) &&
     (!cameraInput || cameraInput.files.length === 0)){
    alert("Please upload a file or take a photo as proof!");
    return;
  }

  if(!completed.includes(i)){
    completed.push(i);
    points+=10;
    localStorage.setItem('completed',JSON.stringify(completed));
    localStorage.setItem('points',points);
    updateDashboard();
    renderTasks();
    celebrate();
  }
}

function updateDashboard(){
  document.getElementById('completedCount').textContent=completed.length;
  document.getElementById('points').textContent=points;
  const percent=Math.round((completed.length/tasks.length)*100);
  const circle=document.getElementById('progressCircle');
  circle.style.setProperty('--progress',percent+"%");
  circle.textContent=percent+"%";
  document.getElementById("progressBar").style.width = percent+"%";

  // badges
  let badgeIcons="";
  if(points>=50) badgeIcons+="🌱";
  if(points>=100) badgeIcons+="🌳";
  if(points>=200) badgeIcons+="🌎";
  document.getElementById('badges').innerHTML=badgeIcons;

  // leaderboard
  leaderboard=leaderboard.map(e=> e.name.includes(username)? {...e,points:points}:e);
  leaderboard.sort((a,b)=>b.points-a.points);
  const lb=document.getElementById('leaderboard');
  lb.innerHTML="";
  leaderboard.forEach((e,idx)=>{
    lb.innerHTML+=`<div class="entry"><span>${idx+1}. ${e.name}</span><span>${e.points} pts</span></div>`;
  });
}

function celebrate(){
  const confetti=document.getElementById('confetti');
  const emojis = ["🍃","🌸","🌍","🍀","🌱"];
  for(let i=0;i<20;i++){
    const span=document.createElement('span');
    span.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    span.style.left=Math.random()*100+"vw";
    span.style.animationDuration=2+Math.random()*3+"s";
    confetti.appendChild(span);
    setTimeout(()=>span.remove(),3000);
  }
}

function resetProgress(){
  if(confirm("Are you sure you want to reset your progress?")){
    localStorage.removeItem('completed');
    localStorage.removeItem('points');
    completed=[];
    points=0;
    updateDashboard();
    renderTasks();
  }
}

renderTasks();
updateDashboard();
</script>
</body>
</html>